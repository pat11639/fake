<!DOCTYPE html><html><head><link rel="stylesheet" href="/assets/css/1140.css" type="text/css" media="screen"><link rel="stylesheet" href="/assets/css/main.css" type="text/css" media="screen"><link rel="alternate" type="application/atom+xml" title="Pat Shaughnessy - Feed" href="http://feeds2.feedburner.com/patshaughnessy"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Mark Methods Private When You Don’t Test Them - Pat Shaughnessy</title></head><body><div id="banner"><div class="row"><div class="onecol"></div><div class="elevencol last"><a href="/"><span id="title">Pat Shaughnessy</span><span id="tagline"> blogger, rubyist, aspiring author</span></a></div></div></div><div id="container"><div class="row"><div class="onecol"></div><div class="ninecol white"><article class="post"><header><h1>Mark Methods Private When You Don’t Test Them</h1><div class="metadata"><span class="date">February 16th 2015</span>&nbsp;&mdash;&nbsp;<a href="#disqus_thread" data-disqus-identifier="http://patshaughnessy.net/2015/2/16/mark-methods-private-when-you-dont-test-them" class="date">&nbsp; Comments and &nbsp; Reactions</a><br><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="pat_shaughnessy" data-text="Mark Methods Private When You Don’t Test Them">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script></div></header><section class="content"><div style="float: left; padding: 7px 30px 0px 0px; text-align: center;">
  <img src="http://patshaughnessy.net/assets/2015/2/16/plaza-de-la-merced.jpg"><br/>
  <i>My father in law once lived in same building where Picasso<br/>was born, near the Plaza de la Merced in Málaga, Spain.</i>
</div>
<p>In Ruby and many other languages, you write private methods to implement
internal logic you don’t want to expose. You want the freedom to rename,
repurpose or even delete them without worrying about impacting anything else.
The <span class="code">private</span> keyword signals other developers: Don’t rely on this; don’t call
it; it might change. This is especially important when writing framework or
library code that many other developers will use.</p>
<p>But which methods should you make private? Sometimes this is obvious; sometimes
it isn’t. A good rule of thumb to use is: If you’re not testing a method, it
should be private.</p>
<p><br/>
<br/></p>
<p>But wait a minute! Aren’t we supposed to test everything? Isn’t 100% code
coverage the nirvana every Ruby developer seeks? Let me clarify. You should
mark methods private when you test them indirectly by calling the other, public
methods in the same class. Use the <span class="code">private</span> keyword to help organize your code,
to remind yourself what you still need to test, and what you don’t.</p>
<h2>Three Paintings</h2>
<p>A simple example will make this clear. Suppose I have a class that describes a
painting:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">Painting </span><span style="color:#4f5b66;">= </span><span style="color:#008080;">Struct</span><span style="color:#000000;">.</span><span style="color:#795da3;">new</span><span style="color:#000000;">(</span><span style="color:#008080;">:name</span><span style="color:#000000;">, </span><span style="color:#008080;">:year</span><span style="color:#000000;">)
</span></pre>

<p>Now I can create a list of three paintings in a <span
class="code">Minitest::Spec</span> file like this:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">let(</span><span style="color:#008080;">:one</span><span style="color:#000000;">) { </span><span style="color:#008080;">Painting</span><span style="color:#000000;">.</span><span style="color:#795da3;">new</span><span style="color:#000000;">(</span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Spanish Couple In Front Of Inn</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">, </span><span style="color:#d08770;">1900</span><span style="color:#000000;">) }
</span><span style="color:#000000;">let(</span><span style="color:#008080;">:two</span><span style="color:#000000;">) { </span><span style="color:#008080;">Painting</span><span style="color:#000000;">.</span><span style="color:#795da3;">new</span><span style="color:#000000;">(</span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Guernica</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">, </span><span style="color:#d08770;">1937</span><span style="color:#000000;">) }
</span><span style="color:#000000;">let(</span><span style="color:#008080;">:three</span><span style="color:#000000;">) { </span><span style="color:#008080;">Painting</span><span style="color:#000000;">.</span><span style="color:#795da3;">new</span><span style="color:#000000;">(</span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Petite Fleurs</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">, </span><span style="color:#d08770;">1958</span><span style="color:#000000;">) }
</span><span style="color:#000000;">let(</span><span style="color:#008080;">:paintings</span><span style="color:#000000;">) { [one, two, three] }
</span></pre>

<p>Suppose my first requirement is to return the first painting from the list.
Simple enough:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">first</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  list.first
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">should return the first element</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  first(paintings).must_equal one
</span><span style="color:#a71d5d;">end
</span></pre>

<p>I just call <span class="code">Array#first</span> and I’m done. Returning the
rest of the list is slightly more interesting:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">rest</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  _, </span><span style="color:#4f5b66;">*</span><span style="color:#000000;">rest </span><span style="color:#4f5b66;">=</span><span style="color:#000000;"> list
</span><span style="color:#000000;">  rest
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the rest of the elements</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  rest(paintings).must_equal [two, three]
</span><span style="color:#a71d5d;">end
</span></pre>

<p>Using <a href="http://devblog.avdi.org/2010/01/31/first-and-rest-in-ruby/">a trick I learned from
Avdi</a>, <span
class="code">rest</span> always returns an array even if the input list was
empty or had only one element. So far, so good. I’ve written two methods and
two tests:</p>
<p><img src="http://patshaughnessy.net/assets/2015/2/16/two-tests.png"/></p>
<h2>A New Requirement</h2>
<p>Now suppose my business requirement changes slightly and I instead need to
return the first painting sorted alphabetically by name. Once again, it’s not
hard to do.</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">first</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  list.sort </span><span style="color:#a71d5d;">do </span><span style="color:#4f5b66;">|</span><span style="color:#000000;">p1, p2</span><span style="color:#4f5b66;">|
</span><span style="color:#000000;">    p1.name </span><span style="color:#4f5b66;">&lt;=&gt;</span><span style="color:#000000;"> p2.name
</span><span style="color:#000000;">  </span><span style="color:#a71d5d;">end</span><span style="color:#000000;">.first
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">should return the first element</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  first(paintings).name.must_equal </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Guernica</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#a71d5d;">end
</span></pre>

<p>And I need <span class="code">rest</span> to use the same sort order, so I repeat the call to <span class="code">sort</span>:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">rest</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  _, </span><span style="color:#4f5b66;">*</span><span style="color:#000000;">rest </span><span style="color:#4f5b66;">=</span><span style="color:#000000;"> list.sort </span><span style="color:#a71d5d;">do </span><span style="color:#4f5b66;">|</span><span style="color:#000000;">p1, p2</span><span style="color:#4f5b66;">|
</span><span style="color:#000000;">    p1.name </span><span style="color:#4f5b66;">&lt;=&gt;</span><span style="color:#000000;"> p2.name
</span><span style="color:#000000;">  </span><span style="color:#a71d5d;">end 
</span><span style="color:#000000;">  rest
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the rest of the elements</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  rest(paintings).map(</span><span style="color:#4f5b66;">&amp;</span><span style="color:#008080;">:name</span><span style="color:#000000;">).must_equal [
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Petite Fleurs</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">,
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Spanish Couple In Front Of Inn</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#000000;">  ]
</span><span style="color:#a71d5d;">end
</span></pre>

<p>I’ve implemented new behavior, but still have two methods and two tests:</p>
<p><img src="http://patshaughnessy.net/assets/2015/2/16/two-tests.png"/></p>
<h2>Extracting a Method</h2>
<p>Because both of my methods are covered by tests, I’m free to refactor them. I
decide to extract a new method, <span class="code">sorted_by_name</span>:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">first</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  sorted_by_name(list).first
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">rest</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  _, </span><span style="color:#4f5b66;">*</span><span style="color:#000000;">rest </span><span style="color:#4f5b66;">=</span><span style="color:#000000;"> sorted_by_name(list)
</span><span style="color:#000000;">  rest
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">sorted_by_name</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  list.sort </span><span style="color:#a71d5d;">do </span><span style="color:#4f5b66;">|</span><span style="color:#000000;">p1, p2</span><span style="color:#4f5b66;">|
</span><span style="color:#000000;">    p1.name </span><span style="color:#4f5b66;">&lt;=&gt;</span><span style="color:#000000;"> p2.name
</span><span style="color:#000000;">  </span><span style="color:#a71d5d;">end
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the element with the first name</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  first(paintings).name.must_equal </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Guernica</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the rest after the first name</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  rest(paintings).map(</span><span style="color:#4f5b66;">&amp;</span><span style="color:#008080;">:name</span><span style="color:#000000;">).must_equal [
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Petite Fleurs</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">,
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Spanish Couple In Front Of Inn</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#000000;">  ]
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span></pre>

<p>Here I’ve simply moved the call to sort into a utility method called
<span class="code">sorted_by_name</span>. Now <span class="code">first</span>
and <span class="code">rest</span> both call <span
class="code">sorted_by_name</span>, making the code a bit clearer and DRY-er. But
now I have three methods and only two tests:</p>
<p><img src="http://patshaughnessy.net/assets/2015/2/16/two-tests-three-methods.png"/></p>
<h2>Mark Methods Private When You Don’t Test Them</h2>
<p>Notice I didn’t bother writing a test for <span class="code">sorted_by_name</span>. I know it works
because my other tests still pass. The existing tests are sufficient; I am
testing <span class="code">sorted_by_name</span> indirectly. Because I extracted <span class="code">sorted_by_name</span> from
<span class="code">first</span> and <span class="code">rest</span>, because I
refactored my code without adding any new behavior, no new test were required.</p>
<p>In this scenario, take the time to mark the new, untested method as private:</p>
<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">first</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  sorted_by_name(list).first
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">rest</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  _, </span><span style="color:#4f5b66;">*</span><span style="color:#000000;">rest </span><span style="color:#4f5b66;">=</span><span style="color:#000000;"> sorted_by_name(list)
</span><span style="color:#000000;">  rest
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#795da3;">private
</span><span style="color:#000000;">
</span><span style="color:#a71d5d;">def </span><span style="color:#795da3;">sorted_by_name</span><span style="color:#000000;">(list)
</span><span style="color:#000000;">  list.sort </span><span style="color:#a71d5d;">do </span><span style="color:#4f5b66;">|</span><span style="color:#000000;">p1, p2</span><span style="color:#4f5b66;">|
</span><span style="color:#000000;">    p1.name </span><span style="color:#4f5b66;">&lt;=&gt;</span><span style="color:#000000;"> p2.name
</span><span style="color:#000000;">  </span><span style="color:#a71d5d;">end
</span><span style="color:#a71d5d;">end
</span></pre>

<pre style="background-color:#ffffff;">
<span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the element with the first name</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  first(paintings).name.must_equal </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Guernica</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">it </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">returns the rest after the first name</span><span style="color:#4f5b66;">&quot; </span><span style="color:#a71d5d;">do
</span><span style="color:#000000;">  rest(paintings).map(</span><span style="color:#4f5b66;">&amp;</span><span style="color:#008080;">:name</span><span style="color:#000000;">).must_equal [
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Petite Fleurs</span><span style="color:#4f5b66;">&quot;</span><span style="color:#000000;">,
</span><span style="color:#000000;">    </span><span style="color:#4f5b66;">&quot;</span><span style="color:#008080;">Spanish Couple In Front Of Inn</span><span style="color:#4f5b66;">&quot;
</span><span style="color:#000000;">  ]
</span><span style="color:#a71d5d;">end
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span><span style="color:#000000;">
</span></pre>

<p>The <span class="code">private</span> keyword here reminds me I’ve already tested <span
class="code">sorted_by_name</span>, that I don’t need to write new tests for
it. Now <span class="code">private</span> is helping me organize my code; it’s helping me remember
which methods I don’t need to test… and which methods are missing important
tests.</p>
<p><img src="http://patshaughnessy.net/assets/2015/2/16/two-tests-three-methods-private.png"/></p>
<p>If my tests don’t need to know about <span class="code">sorted_by_name</span>, then certainly other
developers don’t. It should be private. Marking it private reminds me that it
is being tested indirectly, that I didn’t just forget to write a test for it.
Marking it private tells other developers about what I’ve learned from my own
test suite.</p>
</section><section class="comments"><div id="disqus_thread"><script type="text/javascript">var disqus_identifier = 'http://patshaughnessy.net/2015/2/16/mark-methods-private-when-you-dont-test-them'; var disqus_shortname = 'patshaughnessy'; var disqus_title = 'Mark Methods Private When You Don’t Test Them';</script></div><script type="text/javascript" src="http://disqus.com/forums/patshaughnessy/embed.js"></script><noscript><a href="http://patshaughnessy.disqus.com/?url=ref">View the discussion thread.</a></noscript></section></article><script type="text/javascript">(function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());</script></div><div class="twocol last" id="right"><div id="sidebar"><img src="/assets/images/pat.jpg"></img><div class="header">Subscribe</div><div class="links"><ul><li><a href="https://twitter.com/pat_shaughnessy" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @pat_shaughnessy</a><script>
                      !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
                    </script><a id="feed" href="http://feeds.feedburner.com/patshaughnessy"><img src="/assets/images/feed-icon16x16B.png"></img></a><a href="http://twitter.com/pat_shaughnessy">@pat_shaughnessy</a></li></ul></div><div class="header">Buy my book</div><div class="links"><ul><li><a href="/ruby-under-a-microscope"><img src="/assets/images/book-cover.png"></img></a></li><li id="eBook"><a href="/ruby-under-a-microscope">Ruby Under a Microscope</a></li></ul></div><div class="header">More on Ruby</div><div class="links"><ul><li><a href="2016/10/7/need-a-second-opinion-on-your-ruby-code-ask-crystal">Need a Second Opinion on Your Ruby Code? Ask Crystal</a></li><li><a href="2016/4/2/two-dumb-ruby-mistakes">Two Dumb Ruby Mistakes</a></li><li><a href="2015/6/18/dont-let-your-data-out-of-the-database">Don’t Let Your Data Out of the Database</a></li><li><a href="2015/1/8/using-rake-to-generate-a-blog">Using Rake to Generate a Blog</a></li></ul></div><div class="header">Popular</div><div class="links"><ul><li><a href="/2016/11/26/learning-to-read-x86-assembly-language">Learning to Read x86 Assembly Language</a></li><li><a href="/2012/1/4/never-create-ruby-strings-longer-than-23-characters">Never create Ruby strings longer than 23 characters</a></li><li><a href="/2012/3/23/why-you-should-be-excited-about-garbage-collection-in-ruby-2-0">Why You Should Be Excited About Garbage Collection in Ruby 2.0</a></li><li><a href="/2013/4/3/ruby-2-0-works-hard-so-you-can-be-lazy">Ruby 2.0 Works Hard So You Can Be Lazy</a></li></ul></div><div class="header"><a href="/">More...</a></div></div></div></div><div class="row" id="copyright"><p>Content and UI design &copy; 2019 Pat Shaughnessy</p></div></div></body></html>